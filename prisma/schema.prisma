generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ChatSession {
  id        String   @id
  userId    String
  title     String
  messages  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Document {
  id        String   @id
  userId    String
  name      String
  category  String   @default("General")
  mimeType  String
  size      Int
  data      String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model GuidanceTask {
  id          String    @id
  shortlistId String
  title       String
  type        String
  status      String    @default("pending")
  dueDate     String?
  Shortlist   Shortlist @relation(fields: [shortlistId], references: [id], onDelete: Cascade)

  @@index([shortlistId])
}

model Profile {
  id                   String  @id
  userId               String  @unique
  targetDegree         String
  targetIntake         String
  gpa                  String
  englishTest          String?
  testScore            String?
  budget               String
  preferredCountries   String
  readinessScore       Int     @default(0)
  currentStage         String  @default("DISCOVERY")
  gpaScale             String  @default("4.0")
  citizenship          String?
  fieldOfStudy         String?
  highestQualification String?
  targetMajor          String?
  User                 User    @relation(fields: [userId], references: [id])
}

model Shortlist {
  id           String         @id
  userId       String
  universityId String
  isLocked     Boolean        @default(false)
  createdAt    DateTime       @default(now())
  GuidanceTask GuidanceTask[]
  University   University     @relation(fields: [universityId], references: [id])
  User         User           @relation(fields: [userId], references: [id])

  @@unique([userId, universityId])
  @@index([userId])
}

model University {
  id             String      @id
  name           String      @unique
  location       String
  country        String
  rank           Int
  fees           String
  acceptanceRate String
  tags           String
  Shortlist      Shortlist[]

  @@index([country])
  @@index([location])
  @@index([rank])
}

model User {
  id           String        @id
  email        String        @unique
  fullName     String
  passwordHash String
  createdAt    DateTime      @default(now())
  ChatSession  ChatSession[]
  Document     Document[]
  Profile      Profile?
  Shortlist    Shortlist[]
}
